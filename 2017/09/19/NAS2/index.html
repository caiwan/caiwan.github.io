<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Bővített kiadás"><title>Raspberry PI NAS konfigurálás - 2. Rész - FSTAB | Caiwan Blogja</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Caiwan Blogja</a><span class="subtitle">Farkaska kalajdnai az IT világában. Ugyanitt kedvezményes grafikus képzés.</span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Raspberry PI NAS konfigurálás - 2. Rész - FSTAB</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2017-09-19</div><div class="post-categories"><a class="post-category-link" href="/categories/IT/">IT</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/debian/">debian</a>/<a class="post-tag-link" href="/tags/minibian/">minibian</a>/<a class="post-tag-link" href="/tags/nas/">nas</a>/<a class="post-tag-link" href="/tags/raspberry-pi/">raspberry pi</a>/<a class="post-tag-link" href="/tags/sysop/">sysop</a></div></div></div><article><div class="container post"><p>Idővel szükségessé vált számomra, hogy legyen egy a belső hálózatból, illetve publikusan is elérhető NAS-om. Ezt egy Raspberry PI2 (vagy 3)<br> ami a boltban kapható stock okos dobozok képességein felül egy komplett unix workstation álljon rendelkezésre.</p>
<p>Gyorsan két lépés között applikáljuk bele a rendszerve a külső merevlemezt. Ehhez az fstab-ot szerkesszük át, hogy minél kevesebb gond lehyen vele a későbbiekben.</p>
<p>Kétféle megközelítést írok le, egyiket a másikból lehet foyltatni. Előfeltétel, hogy legyen egy lemez már legyen kellően előkészítve a feladatra. </p>
<h3 id="Informaciok-beszerzese"><a href="#Informaciok-beszerzese" class="headerlink" title="Információk beszerzése"></a>Információk beszerzése</h3><p>A <code>mount</code> és <code>df -T</code> képes információkat szolgáltatni a partíciókról, viszont ehhez mountolni kell őket előbb.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo mount /dev/sda1 /mnt/disk0</div></pre></td></tr></table></figure>
<p><em>Ha nincs könyvtár, akkor értelemszerűen létrehozzuk azt.</em> Majd <code>df -T</code> megmondja, hogy milyen filerendszerre formáztuk a partíciót a lemezen. Ez kell majd az fstab-hoz. <em>A grep értelemszerűen elhagyható.</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ df -T | grep /dev/sda</div><div class="line">/dev/sda1      ext3     480589544 167827592 288342676  37% /mnt/disk0</div></pre></td></tr></table></figure>
<p>Ha mindezzel rendben vagyunk, akkor kezdődhet móka:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo vim /etc/fstab</div></pre></td></tr></table></figure>
<p>Ennek a végre fogjuk beírni a dolgokat. </p>
<h3 id="Setup-pt-1-mount"><a href="#Setup-pt-1-mount" class="headerlink" title="Setup pt 1. - mount"></a>Setup pt 1. - mount</h3><p>Itt direktbe bedrótozzuk (mount) a meghajtót egyetlen könyvtárba. Ez a lépés mindenképpen kell, ha egyáltalán a lemezt a rendszerben akarjuk látni. </p>
<p>Először is, az FSTAB fejléce a következő; minden paraméter egy space-szel van elválasztva, erre érdemes odafigyelni, amikof flageket állítunk be. A mezők rézletzes leírása <a href="https://wiki.archlinux.org/index.php/fstab#Field_definitions" target="_blank" rel="external">erre</a>, illetve a mount beállításai (options mező) pedig <a href="http://man7.org/linux/man-pages/man8/mount.8.html#FILESYSTEM-INDEPENDENT_MOUNT%20OPTIONS" target="_blank" rel="external">erre</a>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># &lt;file system&gt; &lt;dir&gt; &lt;type&gt; &lt;options&gt; &lt;dump&gt; &lt;pass&gt;</div></pre></td></tr></table></figure>
<p>Amit akarunk, az a <code>/dev/sda1</code> -&gt; <code>/mnt/dsik0</code>. Ennke megfelelően:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/dev/sda1 /mnt/disk0 ext3 defaults,noatime,nodiratime,errors=remount-ro 0 1</div></pre></td></tr></table></figure>
<p><em>(A legjobb, ha kimásolod innen.)</em></p>
<p>Röviden:</p>
<ul>
<li>A  <strong>defaults</strong> ad írás-olvasás-futtatás jogokat, megtiltja, hogy más is mountoljon, illetve nem kell megadni útvonalat a mountoláshoz, <code>mount -a /dev/sda1</code> autoimatikusan az fstab bejegyzésnek megfelelő helyre teszti azt. Ezen kívül beállít mást is, de nem fontos.</li>
<li>A <strong>notatime</strong> és <strong>nodiratime</strong> nem fog a lemezre hopzzáférési dánumot írni, így ettől némi gyorsulást várunk - ezt majd későbbiekben</li>
<li>A <strong>error=remount-ro</strong> a hiba esetén való viselkedést befolyásolja. Ha valami töténik a lemezzel, akkor ebben az esetben read-only módban újramountolja.</li>
<li>A <strong>dump</strong> mező legyen nulla, ezzel most nem foglalkozunk. Ha lenne <code>dump</code> telepítve, akkor ez (hiba esetén) biztonsági másolatot készítene.</li>
<li>A <strong>pass</strong> mező az fsck ellenőrzést prioritását adja meg. Ez egy lemezellenőrző tool. Ez legyen 1. <em>Illetve lehet, hogy jobb lenne, ha inkább ulla lenne.</em> <em>(Ez teljesen értelmes volt.)</em></li>
</ul>
<p>Ha megvan, adjunk neki egy rebootot, és nézzük meg, hogy mindent jól csináltunk-e.</p>
<h3 id="Setup-pt-2-bind"><a href="#Setup-pt-2-bind" class="headerlink" title="Setup pt 2. - bind"></a>Setup pt 2. - bind</h3><p>Itt direktbe bedrótozzuk (mount) a meghajtót egyetlen könyvtárba, majd a további könyvtárakat linkeljük a rendszerben (bind).<br>Jelen esetben a könyvtár struktúra a lemezemen úgy néz ki, hogy</p>
<ul>
<li><code>home</code> - értelemszerűen a home directoryk vannak itt</li>
<li><code>git</code> - itt git repok vannak</li>
<li><code>sync</code> - ez a root könyvtára a btsync-nek</li>
</ul>
<p>Ezen nyilván annyi változást akarok véghezvinni, hogy mindenki az én userem home directroyjába dolgozzon, és a samba is ide lenne beállítva. Remélhetőleg a jogokkal nem lesz annyi probléma, mint eddig volt. Lássunk neki ennek. Itt mindenképpen a <code>/mnt/disk0/home</code> -ot linkelni kell a <code>/home</code> útvonalra linkelni. Symlink nem lesz jó, az nem működik meghajtók között, csak azonos filerendszeren belül. A beállítása hasonló, mint eddig, csak a filerendszer típusa <code>none</code> lesz, és az options pedig <code>bind</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/mnt/disk0/home /home none bind 0 0</div></pre></td></tr></table></figure>
<p>Természetesen örökölni fogja azokat a tulajdonságokat, mint az, amire mutat. Egy reboot után nézzük meg, hogy mink van. Ha volt oylan home directory, ami a nevünkre mutat, akkor <em>itt ébredünk fel</em>. Egy <code>chown &lt;te&gt; ./ -R</code> paranccsal rakjunk rendet. <strong>Amennyiben</strong> a meglevő home directorydra van szükség, akkor másold át előtte, vagy <code>umount /home</code>-mal szedd le a mountot, másold át, majd mountold vissza. A a home, amire bindel nem veszik el, csak el lesz fedve.</p>
<p>A következő részben beállítjuk a cron-apt-t, utána telepítünk, és állítunk mindent a helyére.</p>
</div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2017 <a href="/" rel="nofollow">Caiwan</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>