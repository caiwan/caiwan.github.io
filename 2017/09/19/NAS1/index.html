<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Bővített kiadás"><title>Raspberry PI NAS konfigurálás - 1. Rész - Raspbian | Caiwan Blogja</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Caiwan Blogja</a><span class="subtitle">Farkaska kalajdnai az IT világában. Ugyanitt kedvezményes grafikus képzés.</span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>Raspberry PI NAS konfigurálás - 1. Rész - Raspbian</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2017-09-19</div><div class="post-categories"><a class="post-category-link" href="/categories/IT/">IT</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/debian/">debian</a>/<a class="post-tag-link" href="/tags/minibian/">minibian</a>/<a class="post-tag-link" href="/tags/nas/">nas</a>/<a class="post-tag-link" href="/tags/raspberry-pi/">raspberry pi</a>/<a class="post-tag-link" href="/tags/sysop/">sysop</a></div></div></div><article><div class="container post"><h2 id="Bevezeto"><a href="#Bevezeto" class="headerlink" title="Bevezető"></a>Bevezető</h2><p>Idővel szükségessé vált számomra, hogy legyen egy a belső hálózatból, illetve publikusan is elérhető NAS-om. Ezt egy Raspberry PI2 (vagy 3)<br> ami a boltban kapható stock okos dobozok képességein felül egy komplett unix workstation álljon rendelkezésre.</p>
<p>Az első részben megnézzük, hogyan telepítsók és konfiguráljuk az üres Rasbian imaget, majd beállítjuk a héttértárul szolgáló lemezt, majd végól egyenkként felrakjuk, és konfoguráljuk a szolgáltatásokat, amikre szükségünk van.</p>
<h2 id="Az-Image"><a href="#Az-Image" class="headerlink" title="Az Image"></a>Az Image</h2><p>Fontos megjegyezni, hogy ezek a minimal imagek rengeteg mindentől mentesek, így mindent telepíteni - illetve a végén igény szerint pucolni kell. Érdemes egyszer bekonfigurálni jól a lemezképet, majd erről másolatot készíteni. </p>
<p>Én két SD kártyával dolgozok, egyik lesz a kisérleti, a másik pedig majd az éles. Az SD kártyákról röviden annyit, hogy vásárlás során <a href="http://hackaday.com/2015/12/10/which-sd-card-to-use-in-a-pi/" target="_blank" rel="external">ettől a Hackaday cikktől</a> indultam el, és <a href="http://www.raspberrypi-spy.co.uk/2015/11/raspberry-pi-microsd-card-shoot-out/?utm_source=hootsuite#prettyPhoto" target="_blank" rel="external">ezt a banchmarkot</a> vettem alapul</p>
<h3 id="Minibian"><a href="#Minibian" class="headerlink" title="Minibian"></a>Minibian</h3><p>Első körben ezzel próbálkozok. Mivel ez egy teljesen kiherélt disztró, ezért téngleg semmink sincs. Se parancskiegészítés, se bash histrory, semmi. Így minden olyan lesz, mint <a href="https://www.youtube.com/watch?v=3zaWR6eSOVc#t=2m6s" target="_blank" rel="external">Mucsi Zoltán villanyszerelés közben</a>.</p>
<ul>
<li>Bejelentkezés: <code>root</code>:<code>raspberry</code></li>
</ul>
<p>Csekkoljuk le, a lemez- akarom mondani, SD kártyát:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># df -h</div></pre></td></tr></table></figure>
<p>Elméletileg az egész lemezképnek olyan 192 mega körülinkek kell lennie másolás után:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Filesystem      Size  Used Avail Use% Mounted on</div><div class="line">/dev/root       705M  486M  169M  75% /</div><div class="line">devtmpfs        111M     0  111M   0% /dev</div><div class="line">tmpfs           115M     0  115M   0% /dev/shm</div><div class="line">tmpfs           115M  8.3M  107M   8% /run</div><div class="line">tmpfs           5.0M     0  5.0M   0% /run/lock</div><div class="line">tmpfs           115M     0  115M   0% /sys/fs/cgroup</div><div class="line">/dev/mmcblk0p1   61M   20M   42M  32% /boot</div></pre></td></tr></table></figure>
<p>Ezt toljuk ki a lemez teljes egészére.<br>Ehhez kell egy particionáló; legyen ez a <code>parted</code>, mivel ez található a csomagkezelőben. Bármi nemű telepítés előtt érdemes azoinban az apt csomagkezelőt, illetve a már fenntlévő csomagokat frissíteni:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># apt-get update</div><div class="line"># apt-get upgrade</div></pre></td></tr></table></figure>
<p>…  majd mehet a <code>parted</code> telepítése:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># apt-get install parted</div><div class="line"># parted</div></pre></td></tr></table></figure>
<p>Ha minden jól ment, nézzük meg, hogy mink van:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">(parted) print</div><div class="line"></div><div class="line">Model: SD SL08G (sd/mmc)</div><div class="line">Disk /dev/mmcblk0: 7948MB</div><div class="line">Sector size (logical/physical): 512B/512B</div><div class="line">Partition Table: msdos</div><div class="line">Disk Flags:</div><div class="line"></div><div class="line">Number  Start   End     Size    Type     File system  Flags</div><div class="line"> 1      8192B   64.0MB  64.0MB  primary  fat16</div><div class="line"> 2      64.0MB  833MB   769MB   primary  ext4</div></pre></td></tr></table></figure>
<p> Előfordulhat, hogy több lemez van a gépre csatolva, és csak az <code>/dev/sd*</code> meghajtókat litzázza. Nekünk az SD kártya kell, ezért ha nem látnuk a kártcsát, csak a lemezünket, akkor <code>parted /dev/mmcblk0</code> paranccsal indítsuk el.</p>
<p>Nekünk a második partíciót kell módosítani, és mivel nincs mögötte swap partíció, ezért még számolni sem kell hozzá. A <code>resizepart</code> paranccsal simán átméretezzük a partíciót. A partíció vége a lemez vége lesz, amit az előző képernyőn kiírt a print. Nálam ez <code>7948</code>, a 8 gigás kártya végett. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(parted) resizepart 2</div><div class="line">End?  [833MB]? 7948</div></pre></td></tr></table></figure>
<p>A kernel még nem látja a partíció új méretét, ezért egy <code>reboot</code>-tal indítsuk újra. Eztán a fájlrendszert kell átméretezni, hogy kitöltse a partíciót. Ugye, mi a 2. partíciót módosítottuk, ami a <code>p2</code> (mint partition 2) lesz a <code>/dev</code>-ben.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># resize2fs /dev/mmcblk0p2 </div><div class="line"># e2fsck -f /dev/mmcblk0p2</div></pre></td></tr></table></figure>
<p>Ha az <code>e2fsck</code> azzal az üzenettel áll le, hogy nem tudja folytatni a műveletet, akkor:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># fsck -nf /dev/mmcblk0p2</div></pre></td></tr></table></figure>
<p>Vghül ismét egy <code>df -h</code> paranccsal ellenőrizzük, hogy jól ment-e a művelet; illetve távolítsuk el a <code>parted</code> csomagot, mivel nem lesz rá szükség a továbbiakban. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># df -h</div><div class="line"># apt-get remove parted</div></pre></td></tr></table></figure>
<p>Illetve még egy autoremove-ot is érdemes kiadni:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># apt-get autoremove</div></pre></td></tr></table></figure>
<h2 id="Hadrening"><a href="#Hadrening" class="headerlink" title="Hadrening"></a>Hadrening</h2><p>Kezdjük előbb a biztonsági intézkedésekkel. </p>
<h3 id="Felhasznalo-hozzaadasa"><a href="#Felhasznalo-hozzaadasa" class="headerlink" title="Felhasználó hozzáadása"></a>Felhasználó hozzáadása</h3><ul>
<li>saját felhasználók hozzáadad</li>
<li>eltávolítjuk a root felhasználót</li>
</ul>
<p>A továbbiakban még be kell állítanunk az SSH-t. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># apt-get install sudo</div><div class="line"># useradd -d /home/&lt;te&gt; -s /bin/bash &lt;te&gt;</div><div class="line"># passwd &lt;te&gt;</div><div class="line"># usermod -a -G sudo &lt;te&gt;</div></pre></td></tr></table></figure>
<ul>
<li>Amikor felrakod a sudo-t, akkor valamiért nincs meg a csoport, amibe bele kell rakni a usert. Ezt fixelni kell majd.</li>
</ul>
<h3 id="Bash-hasznalata-shell-helyett"><a href="#Bash-hasznalata-shell-helyett" class="headerlink" title="Bash használata shell helyett."></a>Bash használata shell helyett.</h3><ul>
<li>Valamiért a shell az alapértelmezett parancsértelmező, ezért át kell váltani bashra. </li>
<li>Ehhez a <code>chsh</code> kell. </li>
<li>Nem kell paraméterezni. A promtba kell írni, amit feldob, hogy <code>/bin/bash</code>. Enter, és kész.</li>
</ul>
<p>Ennyit erről, a következőkben a lemezt rakjuk a helyére a rendszerben, majd a  megerősítéssel és a <code>cron-apt</code>-vel folytatjuk, utána pedig telepítünk. </p>
<h2 id="Felhasznalt-irodalom"><a href="#Felhasznalt-irodalom" class="headerlink" title="Felhasznált irodalom"></a>Felhasznált irodalom</h2></div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2017 <a href="/" rel="nofollow">Caiwan</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>